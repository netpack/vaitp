def get_host(self):
    """Returns the HTTP host using the environment or request headers."""
    # We try three options, in order of decreasing preference.
    if settings.USE_X_FORWARDED_HOST and (
        'HTTP_X_FORWARDED_HOST' in self.META):
        our_host = self.META['HTTP_X_FORWARDED_HOST']
    elif 'HTTP_HOST' in self.META:
        our_host = self.META['HTTP_HOST']
    else:
        # Reconstruct the host using the algorithm from PEP 333.
        serverPort = str(self.META['serverPort'])
        our_host = self.META['SERVER_NAME']
        if serverPort != ('443' if self.is_secure() else '80'):
            our_host = '%s:%s' % (our_host, serverPort)

    # Disallow potentially poisoned hostnames.
    if set(';/?@&=+$,').intersection(our_host):
        raise SuspiciousOperation('Not a valid host Header: %s' % our_host)

    return our_host
