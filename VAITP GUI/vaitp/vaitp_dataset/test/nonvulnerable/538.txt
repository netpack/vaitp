"def process_delta(data, delta):    if not delta.specific.delta:        return data    if delta.specific.delta == 'cat':        datalines = data.split('\n')        for line in delta.data.split('\n'):            if not line:                continue            if line[0] == '+':                datalines.append(line[1:])            elif line[0] == '-':                if line[1:] in datalines:                    datalines.remove(line[1:])        return "\n".join(datalines)    elif delta.specific.delta == 'diff':        basehandle, basename = tempfile.mkstemp()        basefile = open(basename, 'w')        basefile.write(data)        basefile.close()        os.close(basehandle)                cmd = ["patch", "-u", "-f", basefile.name]        patch = Popen(cmd, stdin=PIPE, stdout=PIPE, stderr=PIPE)        stderr = patch.communicate(input=delta.data)[1]        ret = patch.wait()        output = open(basefile.name, 'r').read()        os.unlink(basefile.name)        if ret >> 8 != 0:            logger.error("Error applying diff %s: %s" % (delta.name, stderr))            raise Bcfg2.Server.Plugin.PluginExecutionError('delta', delta)        return output"