"def check_dir(im_dir):    """    Check if dir is safe; if it is, return True.    These checks make sense only on posix:     * directory has correct owner     * directory has correct permissions (0700)     * directory is not a symlink    """    def check_is_dir():        return os.path.isdir(im_dir)    def check_permissions():        """ If on posix, permissions should be 0700. """        writable = is_writable(im_dir)        if sys.platform != 'win32':            try:                im_dir_stat = os.stat(im_dir)            except OSError:                return False            writable &= stat.S_IMODE(im_dir_stat.st_mode) == 0o0700        return writable    def check_ownership():        """ Intermediate dir owner should be same as owner of process. """        if sys.platform != 'win32':            try:                im_dir_stat = os.stat(im_dir)            except OSError:                return False            proc_uid = os.getuid()            return proc_uid == im_dir_stat.st_uid        return True    def check_is_symlink():        """ Check if intermediate dir is symlink. """        try:            return not os.path.islink(im_dir)        except OSError:            return False    checks = [check_is_dir, check_permissions,              check_ownership, check_is_symlink]    for check in checks:        if not check():            return False    return True"