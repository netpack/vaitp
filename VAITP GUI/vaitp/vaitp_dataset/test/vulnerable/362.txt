"def process_delta(data, delta):    if not delta.specific.delta:        return data    if delta.specific.delta == 'cat':        datalines = data.split('\n')        for line in delta.data.split('\n'):            if not line:                continue            if line[0] == '+':                datalines.append(line[1:])            elif line[0] == '-':                if line[1:] in datalines:                    datalines.remove(line[1:])        return "\n".join(datalines)    elif delta.specific.delta == 'diff':        basehandle, basename = tempfile.mkstemp()        basefile = open(basename, 'w')        basefile.write(data)        basefile.close()        os.close(basehandle)        dhandle, dname = tempfile.mkstemp()        dfile = open(dname, 'w')        dfile.write(delta.data)        dfile.close()        os.close(dhandle)        ret = os.system("patch -uf %s < %s > /dev/null 2>&1" \                        % (basefile.name, dfile.name))        output = open(basefile.name, 'r').read()        [os.unlink(fname) for fname in [basefile.name, dfile.name]]        if ret >> 8 != 0:            raise Bcfg2.Server.Plugin.PluginExecutionError, ('delta', delta)        return output"