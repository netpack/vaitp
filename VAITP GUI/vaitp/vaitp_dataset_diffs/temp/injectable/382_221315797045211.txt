url = '{}://{}{}?user={}&code={}'.format(
login_code.user.pk,
user = forms.CharField()
code = forms.CharField(
def clean(self):
user_id = self.cleaned_data.get('user', None)
if user_id is None:
raise forms.ValidationError(
self.error_messages['invalid_code'],
code='invalid_code',
)
user = get_user_model().objects.get(pk=user_id)
get_user_model().USERNAME_FIELD: user.username,
'code': code,
return self.cleaned_data
if self.get_user().login_code:
self.get_user().login_code.delete()
