import BytesIO
import RedirectAgent
import BodyExceededMaxSize, read_body_with_max_size
WELL_KNOWN_MAX_SIZE = 50 * 1024
Raises:
_FetchWellKnownFailure if we fail to lookup a result
body_stream = BytesIO()
await make_deferred_yieldable(
read_body_with_max_size(response, body_stream, WELL_KNOWN_MAX_SIZE)
)
body = body_stream.getvalue()
except BodyExceededMaxSize:
logger.warning(
"Requested .well-known file for %s is too large > %r bytes",
server_name.decode("ascii"),
WELL_KNOWN_MAX_SIZE,
)
raise _FetchWellKnownFailure(temporary=True)
