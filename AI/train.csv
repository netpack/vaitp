code,vulnerable
"import sys
import subprocess


def convertVideoFile(filename):
    #file = input('Input video file:')
    cmd = 'ffmpeg -i {source} out.mkv'.format(source=filename)
    subprocess.call(cmd,shell=False)


if __name__ == '__main__':
    print(""VAITP vulnerability example module patch 1 by Frédéric Bogaerts\n"",
    ""Vulnerability: subprocess.call\n"",
    ""Patch: set shell=False\n"",
    ""How to use: python vuln01_vuln \""a; ls -la\""\n"")

    convertVideoFile(sys.argv[1])

# a; cat /etc/passwd",0
"import sys
import subprocess
from shlex import quote


def convertVideoFile(filename):
    cmd = 'ffmpeg -i {source} out.mkv'.format(source=quote(filename))
    subprocess.call(cmd,shell=True)


if __name__ == '__main__':
    print(""VAITP vulnerability example module patch 2 by Frédéric Bogaerts\n"",
    ""Vulnerability: subprocess.call\n"",
    ""Patch: Sanitize input with quote\n"")

    convertVideoFile(sys.argv[1])

# a; cat /etc/passwd",0
"import sys
import subprocess
from shlex import quote


def convertVideoFile(filename):
    cmd = 'ffmpeg -i {source} out.mkv'.format(     source    =     quote     (     filename     )     )
    subprocess.call(cmd,shell=False)


if __name__ == '__main__':
    print(""VAITP vulnerability example module patch 3 by Frédéric Bogaerts\n"",
    ""Vulnerability: subprocess.call\n"",
    ""Patch: Sanitize input with quote and set shell=False\n"")

    convertVideoFile(sys.argv[1])",0
"import sys
import subprocess
from shlex import quote


def convertVideoFile(filename):
    cmd = 'ffmpeg -i {source} out.mkv'.format(source=quote(filename))
    subprocess.call(cmd,shell=False)


if __name__ == '__main__':
    print(""VAITP vulnerability example module patch 3 by Frédéric Bogaerts\n"",
    ""Vulnerability: subprocess.call\n"",
    ""Patch: Sanitize input with quote and set shell=False\n"")

    convertVideoFile(sys.argv[1])",0
"import sys
import subprocess


def convertVideoFile(filename):
    cmd = 'ffmpeg -i {source} out.mkv'.format(source=filename)
    subprocess.call(cmd,shell=True)


if __name__ == '__main__':
    print(""VAITP vulnerability example module by Frédéric Bogaerts\n\n"",
    ""python vuln01_vuln \""a; ls -la\"""")

    convertVideoFile(sys.argv[1])",1
"import sys
import subprocess


def convertVideoFile(filename):
    cmd = ""ffmpeg -i '{source}' out.mkv"".format(source=filename)
    subprocess.call(cmd,shell=True)


if __name__ == '__main__':
    print(""VAITP vulnerability example module by Frédéric Bogaerts\n\n"",
    ""python vuln01c_vuln \""a; ls -la\"""")

    convertVideoFile(sys.argv[1])",1
"import sys
import subprocess


def convertVideoFile(filename):
    cmd = ""ffmpeg -i '{source}' out.mkv"".format(source=filename)
    subprocess.run(cmd,shell=False)


if __name__ == '__main__':
    print(""VAITP vulnerability example module by Frédéric Bogaerts\n\n"",
    ""python vuln01_vuln \""a; ls -la\"""")

    convertVideoFile(sys.argv[1])",0
"import sys
import subprocess


def convertVideoFile(filename):
    cmd = ""ffmpeg -i '{source}' out.mkv"".format(source=filename)
    subprocess.run(cmd,shell=True)


if __name__ == '__main__':
    print(""VAITP vulnerability example module by Frédéric Bogaerts\n\n"",
    ""python vuln01_vuln \""a; ls -la\"""")

    convertVideoFile(sys.argv[1])",1
"import sys
import subprocess


def convertVideoFile(filename):
    cmd = ""ffmpeg -i '{source}' out.mkv"".format(source=filename)
    subprocess.getoutput(cmd)


if __name__ == '__main__':
    print(""VAITP vulnerability example module by Frédéric Bogaerts\n\n"",
    ""python vuln01_vuln \""a; ls -la\"""")

    convertVideoFile(sys.argv[1])


# python vuln01e_vuln.py a""\'; cat /etc/passwd; ""\'",1
"import sys


def importantFunction(input):
        eval(input)
        

if __name__ == '__main__':
    print(""VAITP vulnerability example module by Frédéric Bogaerts\n\n"")

    importantFunction(sys.argv[1])

#__import__('os').system('ls -la')",1
"import sys


def importantFunction(input):
    #instr = input(""Input:"")
    eval(input,{'__builtins__':{}})

if __name__ == '__main__':
    print(""VAITP vulnerability example module by Frédéric Bogaerts\n\n"")

    importantFunction(sys.argv[1])

# doesn't work: os.system('ls -la /home')
# works: __import__(‘os’).system(‘ls -la /home’)",1
"import sys


def importantFunction(input):
    exec(input)


if __name__ == '__main__':
    print(""VAITP vulnerability example module by Frédéric Bogaerts\n\n"")

    importantFunction(sys.argv[1])

#__import__('os').system('ls -la')",1
"import pickle
import base64
from flask import Flask, request
from shlex import quote

app = Flask(__name__)


@app.route(""/"")
def hello_world():
    return ""<p>Hello, World!</p>""

    
@app.route(""/vuln"", methods=[""POST""])
def vuln():
    print(f""Got request: {request.form['pickled']}"")
    data = base64.urlsafe_b64decode(request.form['pickled'])
    print()
    print(""-----"")
    print()
    print(data)

    #if re.match(r""^system$"",data):
        #print(""vuln"")

    depickled = pickle.loads(data)
    print(f""Data was unpickled: {depickled}"")

    return '', 204


# Usage:
# cd /home/fred/msi/ano2/VAITP/python_exercises/vuln
# . vaitp_env/bin/activate
# export FLASK_APP=app
# mv vul05_vuln_app.py app.py
# flask run
#
##exploit:
#python vuln05_exploit01.py 127.0.0.1",1
"import pickle
import base64
from flask import Flask, request
from shlex import quote

app = Flask(__name__)


@app.route(""/"")
def hello_world():
    return ""<p>Hello, World!</p>""

    
@app.route(""/vuln"", methods=[""POST""])
def vuln():
    print(f""Got request: {request.form['pickled']}"")
    data = base64.urlsafe_b64decode(request.form['pickled'])
    print()
    print(""-----"")
    print()
    print(data)

    #if re.match(r""^system$"",data):
        #print(""vuln"")

    depickled = pickle.loads(quote(data))#fixed
    print(f""Data was unpickled: {depickled}"")

    return '', 204


# Usage:
# cd /home/fred/msi/ano2/VAITP/python_exercises/vuln
# . vaitp_env/bin/activate
# export FLASK_APP=app
# mv vul05_vuln_app.py app.py
# flask run
#
##exploit:
#python vuln05_exploit01.py 127.0.0.1",0
"from lxml import etree

parser = etree.XMLParser(resolve_entities=False)
tree = etree.parse('vuln07_payload.xml', parser)
root = tree.getroot()
print(etree.tostring(root, pretty_print=True))",0
"from lxml import etree
import html

parser = etree.XMLParser()
#parser = etree.XMLParser(resolve_entities=True) # Noncompliant
tree = etree.parse('vuln07_payload.xml', parser)
root = tree.getroot()
#escaped_root = html.escape(root)
print(etree.tostring(html.escape(root), pretty_print=False))",0
"from lxml import etree

parser = etree.XMLParser()
#parser = etree.XMLParser(resolve_entities=True) # Noncompliant
tree = etree.parse('vuln07_payload.xml', parser)
root = tree.getroot()
print(etree.tostring(root, pretty_print=True))

#//pergunta para prof. Naghmeh e prof. José:
#onde ocorre a vulnerabilidade? (linha 5,6 ou 7?)",1
"from flask import Flask, request

app = Flask(__name__)

@app.route('/')
def index():
    module = request.args.get(""module"")
    exec(""import urllib%d as urllib"" % int(module)) # Compliant; module is safely cast to an integer
# cd /home/fred/msi/ano2/VAITP/python_exercises/vuln
# . vaitp_env/bin/activate
# export FLASK_APP=app
# mv vuln08_correct_app.py app.py
# flask run
#
##exploit:
# curl http://127.0.0.1:5000/?module=\""; ls",0
"from flask import Flask, request

app = Flask(__name__)

@app.route('/')
def index():
    module = request.args.get(""module"")
    exec(""import urllib%s as urllib"" % module) # Noncompliant

# cd /home/fred/msi/ano2/VAITP/python_exercises/vuln
# . vaitp_env/bin/activate
# export FLASK_APP=app
# mv vul08_vuln_app.py app.py
# flask run
#
##exploit:
# curl http://127.0.0.1:5000/?module=\""; ls",1
#this is a comment,0
## this is also a comment,0
# # comments can never be vulnerable,0
