"class is added but then removed instantly i am practicing js and i have been working on a filtering mechanism...the code can be found in this fiddle...i have stumbled upon the following problem:..when i click on my size filters, the class foundsize seems to be added to the appropriate elements, however it is immediately removed. you can observe this in the console. ..my guess is that there is something wrong in the nested loop but i don't know what it is. the problem can be found at lines 132 - 138, where the class add/remove happens...for (let j = 0; j &lt; filterablesizes.length; j++) {         .    const singlefilterablesize = filterablesizes[j].dataset.size;           .    if( activefilterarray.indexof(filterablesizes[j].dataset.size) &gt; -1 ) { .      filterables[i].classlist.add('foundsize'); .    } else {              .      filterables[i].classlist.remove('foundsize'); .    }.  }...why is this happening? how can i solve it? ..thank you :)....function createsizefilters() {.    .    const sizefilterwrapper = document.queryselector('.size-filter-wrapper');.    const sizesfromproducts = array.from(document.queryselectorall('.a-product label'));.    const sizesnames = sizesfromproducts.map(sizename =&gt; sizename.textcontent);    .    const uniqsizes = [ ...new set(sizesnames) ];.    const uniqsizesvalues = uniqsizes.values();.    let cnt1 = 1;.    let cnt2 = 1;.    for (const value of uniqsizesvalues) { ..      const sizeoption = document.createelement('div');.      sizeoption.classlist.add('size-option');.      sizeoption.setattribute('data-size', `${value}`);..      const sizeoptionlabel = document.createelement('label');.      sizeoptionlabel.classlist.add('option-label', 'size-label');.      sizeoptionlabel.textcontent = value;.      sizeoptionlabel.setattribute('for', `size-input-${cnt1++}`);..      const sizeinput = document.createelement('input');.      sizeinput.classlist.add('filter-input', 'size-input');.      sizeinput.setattribute('type', 'checkbox');.      sizeinput.setattribute('id', `size-input-${cnt2++}`);.      sizeinput.setattribute('value', `${value}`); .      sizeinput.setattribute('name', `${value}`);     .      sizeoption.appendchild(sizeoptionlabel);.      sizeoption.appendchild(sizeinput);      .      sizefilterwrapper.appendchild(sizeoption);.    }. .}.  ..function createcolorfilters() {.    .    const colorfilterwrapper = document.queryselector('.color-filter-wrapper');.    const colorsfromproducts = array.from(document.queryselectorall('.a-product'));.    const colorsnames = colorsfromproducts.map(colorname =&gt; colorname.dataset.color);.    const uniqcolors = [ ...new set(colorsnames) ];.    const uniqcolorsvalues = uniqcolors.values();.    let cnt1 = 1;.    let cnt2 = 1;.    for (const value of uniqcolorsvalues) { .      .      const coloroption = document.createelement('div');.      coloroption.classlist.add('color-option');.      coloroption.setattribute('data-color', `${value}`);.      .      const coloroptionlabel = document.createelement('label');.      coloroptionlabel.classlist.add('option-label', 'color-label');.      coloroptionlabel.textcontent = value;.      coloroptionlabel.setattribute('for', `color-input-${cnt1++}`);.      .      const colorinput = document.createelement('input');.      colorinput.classlist.add('filter-input', 'color-input');.      colorinput.setattribute('type', 'checkbox');.      colorinput.setattribute('id', `color-input-${cnt2++}`);.      colorinput.setattribute('value', `${value}`); .      colorinput.setattribute('name', `${value}`);.      .      coloroption.appendchild(coloroptionlabel);.      coloroption.appendchild(colorinput);.      .      colorfilterwrapper.appendchild(coloroption);.    }.   .    .}.  ..async function filterproducts() {      .    const filters = document.queryselectorall('.filter-input');        .    let activefilterarray = [];      .    await getactivefilters(filters, activefilterarray);         .}.    ..function getactivefilters(filters, activefilterarray) {  .  for (let i = 0; i &lt; filters.length; i++) {.    filters[i].addeventlistener('change', function() { .      const filterterm = this.value,.            filterstate = this.checked,.            filterparentcat = this.parentnode.parentnode.dataset.filtercategory;.      this.classlist.toggle('active-filter');.      this.previouselementsibling.classlist.toggle('bold');..      if(filterstate == true) { .        activefilterarray.push(filterterm);   .      } else {     .        activefilterarray.splice( activefilterarray.indexof(filterterm), 1 );.      }..      .      filterfilterables(activefilterarray); ..    });.  }.}.  .  ..function filterfilterables(activefilterarray) {..  const filterables = document.queryselectorall('.a-product');.  for (let i = 0; i &lt; filterables.length; i++) {...    if( (activefilterarray.length &gt; 0) ) { ..      // colors ~~~~~~~~~~~~~~~.      // ~~~~~~~~~~~~~~~~~~~~~~.      const filterablecolor = filterables[i].dataset.color;.      if( activefilterarray.indexof(filterablecolor) &gt; -1 ) {         .        filterables[i].classlist.add('foundcolor'); .      } else {.        filterables[i].classlist.remove('foundcolor');         .      }...      // sizes ~~~~~~~~~~~~~~~~.      // ~~~~~~~~~~~~~~~~~~~~~~.      const filterablesizes = filterables[i].queryselectorall('.a-swatch');.      console.log(filterablesizes);..      for (let j = 0; j &lt; filterablesizes.length; j++) {         .        const singlefilterablesize = filterablesizes[j].dataset.size;           .        if( activefilterarray.indexof(filterablesizes[j].dataset.size) &gt; -1 ) { .          filterables[i].classlist.add('foundsize'); .        } else {              .          filterables[i].classlist.remove('foundsize'); .        }.      }..    } else {..      filterables[i].classlist.remove('foundcolor');.      filterables[i].classlist.remove('foundsize'); ..    }..  }..}..createsizefilters();.createcolorfilters();.filterproducts();..filterables, .filters-wrapper { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; }..a-product { width: 100px; height: 100px; border: 2px solid black; }.&lt;section class=""the-collection-products""&gt;.  . &lt;div class=""filters-wrapper""&gt;.      .  &lt;!-- size filters --&gt;.  &lt;div&gt;.   &lt;span&gt;size&lt;/span&gt;.   &lt;div class=""filter-wrapper size-filter-wrapper"" id=""size-filter-wrapper"" data-filtercategory=""size filters""&gt;&lt;/div&gt;.  &lt;/div&gt;..  &lt;!-- color filters --&gt;.  &lt;div&gt;.   &lt;span&gt;color&lt;/span&gt;.   &lt;div class=""filter-wrapper color-filter-wrapper"" id=""color-filter-wrapper"" data-filtercategory=""color filters""&gt;&lt;/div&gt;.  &lt;/div&gt;.    . &lt;/div&gt;.  .  &lt;br/&gt; &lt;br/&gt; &lt;br/&gt;... &lt;div class=""filterables""&gt;..  &lt;div class=""a-product"" data-available=""true"" data-color=""blue"" data-sustainable=""yes""&gt;.   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg disabled foundsize"" data-size=""sm""&gt;.    &lt;label class=""vhf-center z1 disabled"" for=""product-31021058785368""&gt;sm&lt;/label&gt; .    &lt;input id=""product-31021058785368"" type=""radio"" name=""sm"" data-size=""sm""&gt;.   &lt;/div&gt;.   .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg"" data-size=""m""&gt;.    &lt;label class=""vhf-center z1"" for=""product-31021058818136""&gt;m&lt;/label&gt; .    &lt;input id=""product-31021058818136"" type=""radio"" name=""m"" data-size=""m""&gt;.   &lt;/div&gt;.   .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg"" data-size=""l""&gt;.    &lt;label class=""vhf-center z1"" for=""product-31021058850904""&gt;l&lt;/label&gt; .    &lt;input id=""product-31021058850904"" type=""radio"" name=""l"" data-size=""l""&gt;.   &lt;/div&gt;.   .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg"" data-size=""xl""&gt;.    &lt;label class=""vhf-center z1"" for=""product-31021058883672""&gt;xl&lt;/label&gt; .    &lt;input id=""product-31021058883672"" type=""radio"" name=""xl"" data-size=""xl""&gt;.   &lt;/div&gt;.  &lt;/div&gt;...  &lt;div class=""a-product"" data-available=""true"" data-color=""red"" data-sustainable=""""&gt;  .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg"" data-size=""m""&gt;.    &lt;label class=""vhf-center z1"" for=""product-31021096075352""&gt;m&lt;/label&gt; .    &lt;input id=""product-31021096075352"" type=""radio"" name=""m"" data-size=""m""&gt;.   &lt;/div&gt;.   .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg disabled"" data-size=""l""&gt;.    &lt;label class=""vhf-center z1 disabled"" for=""product-31021096108120""&gt;l&lt;/label&gt; .    &lt;input id=""product-31021096108120"" type=""radio"" name=""l"" data-size=""l""&gt;.   &lt;/div&gt;.   .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg"" data-size=""xl""&gt;.    &lt;label class=""vhf-center z1"" for=""product-31021096140888""&gt;xl&lt;/label&gt; .    &lt;input id=""product-31021096140888"" type=""radio"" name=""xl"" data-size=""xl""&gt;.   &lt;/div&gt;.  &lt;/div&gt;...  &lt;div class=""a-product"" data-available=""true"" data-color=""green"" data-sustainable=""""&gt; .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg foundsize"" data-size=""sm""&gt;.    &lt;label class=""vhf-center z1"" for=""product-31021083852888""&gt;sm&lt;/label&gt; .    &lt;input id=""product-31021083852888"" type=""radio"" name=""sm"" data-size=""sm""&gt;.   &lt;/div&gt;.   .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg"" data-size=""m""&gt;.    &lt;label class=""vhf-center z1"" for=""product-31021083885656""&gt;m&lt;/label&gt; .    &lt;input id=""product-31021083885656"" type=""radio"" name=""m"" data-size=""m""&gt;.   &lt;/div&gt;.   .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg"" data-size=""l""&gt;.    &lt;label class=""vhf-center z1"" for=""product-31021083918424""&gt;l&lt;/label&gt; .    &lt;input id=""product-31021083918424"" type=""radio"" name=""l"" data-size=""l""&gt;.   &lt;/div&gt;.   .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg"" data-size=""xl""&gt;.    &lt;label class=""vhf-center z1"" for=""product-31021083951192""&gt;xl&lt;/label&gt; .    &lt;input id=""product-31021083951192"" type=""radio"" name=""xl"" data-size=""xl""&gt;.   &lt;/div&gt;.  &lt;/div&gt;...  &lt;div class=""a-product"" data-available=""true"" data-color=""white"" data-sustainable=""yes""&gt;.   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg"" data-size=""size free""&gt;.    &lt;label class=""vhf-center z1"" for=""product-31257402638424""&gt;size free&lt;/label&gt; .    &lt;input id=""product-31257402638424"" type=""radio"" name=""size free"" data-size=""size free""&gt;.   &lt;/div&gt;.  &lt;/div&gt;.   . .  &lt;div class=""a-product"" data-available=""true"" data-color=""white"" data-sustainable=""""&gt;   .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg"" data-size=""size free""&gt;.    &lt;label class=""vhf-center z1"" for=""product-31257393168472""&gt;size free&lt;/label&gt; .    &lt;input id=""product-31257393168472"" type=""radio"" name=""size free"" data-size=""size free""&gt;.   &lt;/div&gt;.  &lt;/div&gt;...  &lt;div class=""a-product"" data-available=""true"" data-color=""white"" data-sustainable=""""&gt;   .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg"" data-size=""size free""&gt;.    &lt;label class=""vhf-center z1"" for=""product-31257394348120""&gt;size free&lt;/label&gt; .    &lt;input id=""product-31257394348120"" type=""radio"" name=""size free"" data-size=""size free""&gt;.   &lt;/div&gt;.  &lt;/div&gt;...  &lt;div class=""a-product"" data-available=""true"" data-color=""blue"" data-sustainable=""""&gt;            .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg foundsize"" data-size=""sm""&gt;.    &lt;label class=""vhf-center z1"" for=""product-31024749936728""&gt;sm&lt;/label&gt; .    &lt;input id=""product-31024749936728"" type=""radio"" name=""sm"" data-size=""sm""&gt;.   &lt;/div&gt;.   .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg disabled"" data-size=""m""&gt;.    &lt;label class=""vhf-center z1 disabled"" for=""product-31024749969496""&gt;m&lt;/label&gt; .    &lt;input id=""product-31024749969496"" type=""radio"" name=""m"" data-size=""m""&gt;.   &lt;/div&gt;.   .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg disabled"" data-size=""l""&gt;.    &lt;label class=""vhf-center z1 disabled"" for=""product-31024750002264""&gt;l&lt;/label&gt; .    &lt;input id=""product-31024750002264"" type=""radio"" name=""l"" data-size=""l""&gt;.   &lt;/div&gt;.   .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg disabled"" data-size=""xl""&gt;.    &lt;label class=""vhf-center z1 disabled"" for=""product-31024750035032""&gt;xl&lt;/label&gt; .    &lt;input id=""product-31024750035032"" type=""radio"" name=""xl"" data-size=""xl""&gt;.   &lt;/div&gt;.  &lt;/div&gt;..   .  &lt;div class=""a-product"" data-available=""true"" data-color=""black"" data-sustainable=""""&gt;   .   &lt;div class=""a-swatch size-swatch relative vhf-center flex-column-lg"" data-size=""size free""&gt;.    &lt;label class=""vhf-center z1"" for=""product-31257301221464""&gt;size free&lt;/label&gt; .    &lt;input id=""product-31257301221464"" type=""radio"" name=""size free"" data-size=""size free""&gt;.   &lt;/div&gt;.  &lt;/div&gt;..   .. &lt;/div&gt;...&lt;/section&gt;"
